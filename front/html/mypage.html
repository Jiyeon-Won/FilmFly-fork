<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>FilmFly</title>
  <!-- 부트 스트랩 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
        crossorigin="anonymous">
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <!-- 공통 헤더 -->
  <script src="../js/common.js"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <script src="../js/apiModule.js"></script>

  <link rel="stylesheet" href="../css/reset.css">
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
<div class="container">
  <!-- 공통 헤더 -->
  <header id="common-header"></header>

  <div class="mb-3">
    <div class="d-flex align-items-center">
      <div class="me-3">
        <img id="profile-picture" src="../images/profileImg.png" class="img-profile-big-size" alt="프로필 사진">
      </div>
      <div id="nickname">
        ${nickname}
      </div>
      <div class="d-flex justify-content-end flex-grow-1">
        <button class="btn btn-primary" onclick="location.href='./mypage-update.html'">수정</button>
      </div>
    </div>
    <div class="mt-2">
      <p class="fs-5 fw-bold">한줄 소개</p>
      <p class="p-3" id="introduce">${user.introduce}</p>
    </div>
  </div>

  <div class="card w-100 my-5">
    <ul class="list-group list-group-flush">
      <li class="list-group-item">
        <div id="btnActiveUser" class="d-flex justify-content-between" style="padding: 12px 0; cursor:pointer;">
          <span style="font-size: 20px; color: red">탈퇴한 계정 복구하기</span>
          <div>
            <!--            <span>12</span>-->
            <i class="fa-solid fa-chevron-right"></i>
          </div>
        </div>
      </li>
    </ul>
  </div>

  <div class="card w-100 mb-3">
    <ul class="list-group list-group-flush">
      <li class="list-group-item">
        <a id="collection-link" href="#">
          <span>영화 보관함</span>
          <div>
            <!--            <span>12</span>-->
            <i class="fa-solid fa-chevron-right"></i>
          </div>
        </a>
      </li>
    </ul>
  </div>

  <div class="card w-100 mb-3">
    <ul class="list-group list-group-flush">
      <li class="list-group-item">
        <a id="review-link" href="#">
          <span>작성한 리뷰</span>
          <div>
            <i class="fa-solid fa-chevron-right"></i>
          </div>
        </a>
      </li>
      <li class="list-group-item">
        <a id="board-link" href="#">
          <span>작성한 게시물</span>
          <div>
            <i class="fa-solid fa-chevron-right"></i>
          </div>
        </a>
      </li>
      <li class="list-group-item">
        <a id="comment-link" href="#">
          <span>작성한 댓글</span>
          <div>
            <i class="fa-solid fa-chevron-right"></i>
          </div>
        </a>
      </li>
    </ul>
  </div>

  <div class="card w-100 mb-3">
    <ul class="list-group list-group-flush">
      <li class="list-group-item">
        <a id="favorite-movie-link" href="#">
          <span>찜한 영화 목록</span>
          <div>
            <i class="fa-solid fa-chevron-right"></i>
          </div>
        </a>
      </li>
      <li class="list-group-item">
        <a id="good-link" href="#">
          <span>좋아요</span>
          <div>
            <i class="fa-solid fa-chevron-right"></i>
          </div>
        </a>
      </li>
      <li class="list-group-item">
        <a id="bad-link" href="#">
          <span>싫어요</span>
          <div>
            <i class="fa-solid fa-chevron-right"></i>
          </div>
        </a>
      </li>
    </ul>
  </div>

  <div class="card w-100 mb-3">
    <ul class="list-group list-group-flush">
      <li class="list-group-item">
        <a id="coupon-link" href="#">
          <span>받은 쿠폰 확인</span>
          <div>
            <i class="fa-solid fa-chevron-right"></i>
          </div>
        </a>
      </li>
    </ul>
  </div>

  <div class="card w-100 mb-3">
    <ul class="list-group list-group-flush">
      <li class="list-group-item">
        <a id="block-link" href="#">
          <span>차단 목록</span>
          <div>
            <i class="fa-solid fa-chevron-right"></i>
          </div>
        </a>
      </li>
    </ul>
  </div>

  <div class="card w-100 mb-3">
    <ul class="list-group list-group-flush">
      <li class="list-group-item">
        <div id="btnWithdraw" class="d-flex justify-content-between" style="padding: 12px 0; cursor:pointer;">
          <span>회원탈퇴</span>
          <div>
            <i class="fa-solid fa-chevron-right"></i>
          </div>
        </div>
      </li>
    </ul>
  </div>
</div>

<script>
  let userId = "";

  // 로그인한 계정 정보 가져옴 (프로필Url, id, Nickname, introduce)
  $(document).ready(function () {
    apiModule.GET("/users/myInfo",
        function (response) {
          const data = response.data;

          // 프로필 이미지 설정
          const profileImage = data.pictureUrl || '../images/profileImg.png';
          $('#profile-picture').attr('src', profileImage);

          // 닉네임 설정
          $('#nickname').text(data.nickname);

          // 한줄 소개 설정(nullable = true)
          $('#introduce').text(data.introduce || "등록된 소개가 없습니다.");

          // 유저 ID 저장
          userId = data.id;

          // 링크 동적 설정
          $('#collection-link').attr('href', `./mypage-collection.html?user=${userId}`);
          $('#review-link').attr('href', `./mypage-review.html?user=${userId}`);
          $('#board-link').attr('href', `./mypage-board.html?user=${userId}`);
          $('#comment-link').attr('href', `./mypage-comment.html?user=${userId}`);
          $('#favorite-movie-link').attr('href', `./mypage-favorite-movie.html?user=${userId}`);
          $('#good-link').attr('href', `./mypage-good.html?user=${userId}`);
          $('#bad-link').attr('href', `./mypage-bad.html?user=${userId}`);
          $('#coupon-link').attr('href', `./mypage-coupon.html?user=${userId}`);
          $('#block-link').attr('href', `./mypage-block.html?user=${userId}`);
        }, function (){
          alert("유저 정보를 불러오는데 실패했습니다.");
        }
    );

    $('#btnWithdraw').on('click', function () {
      alert('탈퇴 하시겠습니까?');
    });

    $('#btnActiveUser').on('click', function () {
      alert('복구 하시겠습니까?');
    });
  });
</script>
</body>
</html>
